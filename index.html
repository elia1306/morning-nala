<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>~ Good Morning Nala ~</title>
    <link href="https://fonts.googleapis.com/css2?family=Bangers&family=Fredoka:wght@400;600&family=Indie+Flower&family=Patrick+Hand&display=swap" rel="stylesheet">
    <style>
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        :root {
            /* ğŸ’œ K-Pop æ‡‰æ´è‰²ç›¤ */
            --primary: #9b59b6;       /* åŸºåº•ç´« */
            --primary-dark: #8e44ad;  /* æ·±ç´« */
            --neon-pink: #ff79c6;     /* éœ“è™¹ç²‰ */
            --neon-blue: #8be9fd;     /* é›»å…‰è— */
            --bg-color: #f8f0fc;      /* æ·¡ç´«èƒŒæ™¯ */
            --card-bg: rgba(255, 255, 255, 0.95);
            --text-color: #2c3e50;
            --gold: #f1c40f;
            
            --font-hand: 'Indie Flower', cursive;
            --font-bold: 'Fredoka', sans-serif;
        }

        body {
            font-family: var(--font-hand);
            color: var(--text-color);
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            padding-bottom: calc(20px + env(safe-area-inset-bottom));

            /* ==========================================================
               ğŸ¨ ã€èƒŒæ™¯è¨­å®šå€ (Background Config)ã€‘
               ========================================================== */
            
            /* 1. èƒŒæ™¯åº•è‰² (æ·¡ç´«è‰²) */
            background-color: var(--bg-color);

            /* 2. èƒŒæ™¯åœ–ç‰‡ (è‹¥è¦ç”¨è‡ªå·±çš„åœ–ï¼Œè«‹æ”¹æª”åï¼Œä¾‹å¦‚ 'idol.jpg') */
            /* é è¨­: å¹¾ä½•åœ–å½¢è£é£¾ */
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(155, 89, 182, 0.1) 0%, transparent 20%),
                radial-gradient(circle at 90% 80%, rgba(255, 121, 198, 0.15) 0%, transparent 20%);
            
            /* è‹¥æ‚¨ä¸Šå‚³äº†ç…§ç‰‡ï¼Œè«‹æŠŠä¸‹é¢é€™è¡Œå–æ¶ˆè¨»è§£ (åˆªé™¤å‰é¢çš„ //) */
            /* background-image: url('bg.png'); */

            /* 3. åœ–ç‰‡é¡¯ç¤ºè¨­å®š */
            background-size: cover;       /* å¡«æ»¿ç•«é¢ */
            background-position: center;  /* å±…ä¸­ */
            background-repeat: no-repeat;
            background-attachment: fixed; /* å›ºå®šä¸æ²å‹• */
        }

        /* æ¨™é¡Œèˆ‡ Header */
        header { 
            width: 100%; max-width: 500px;
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 20px;
        }

        h1 {
            font-family: 'Bangers', cursive; /* æ¼«ç•«è‹±é›„å­—é«” */
            font-size: 2.5rem;
            color: var(--primary-dark);
            text-shadow: 2px 2px 0px var(--neon-pink);
            margin: 0;
            letter-spacing: 1px;
        }

        .clock-badge {
            background: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-family: var(--font-bold);
            font-size: 1.2rem;
            color: var(--primary);
            border: 2px solid var(--neon-pink);
            box-shadow: 2px 2px 0 rgba(0,0,0,0.1);
        }

        /* ç¸½æ˜Ÿæ˜Ÿé¡¯ç¤º (å³ä¸Šè§’) */
        .total-stars-display {
            background: white;
            padding: 5px 12px;
            border-radius: 15px;
            display: flex; align-items: center; gap: 5px;
            border: 2px solid var(--gold);
            font-family: var(--font-bold);
            color: #f39c12;
            font-size: 1.1rem;
            margin-top: 5px;
        }

        /* âœ¨ ä»»å‹™å¡ç‰‡ */
        .card {
            background: var(--card-bg);
            width: 100%; max-width: 500px;
            border-radius: 20px;
            padding: 25px 20px;
            margin-bottom: 20px;
            border: 3px solid var(--primary);
            box-shadow: 6px 6px 0px rgba(155, 89, 182, 0.2);
            position: relative;
            backdrop-filter: blur(5px);
        }

        .task-list { list-style: none; padding: 0; margin: 0; }

        .task-item {
            font-size: 1.5rem;
            margin-bottom: 15px;
            padding: 8px;
            border-bottom: 2px dashed #ddd;
            display: flex; align-items: center;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        /* é€±äºŒç‰¹æ®Šä»»å‹™æ¨£å¼ */
        .task-item.special {
            background: #e8f4fd;
            border-radius: 10px;
            border-bottom: none;
            color: #2980b9;
        }

        .checkbox {
            width: 28px; height: 28px;
            border: 2px solid var(--primary);
            border-radius: 50%;
            margin-right: 15px;
            display: flex; align-items: center; justify-content: center;
            flex-shrink: 0;
            background: white;
        }

        .task-item.checked { text-decoration: line-through; color: #aaa; }
        .task-item.checked .checkbox { background: var(--primary); }
        .task-item.checked .checkbox::after { content: 'âœ”'; color: white; font-size: 1.2rem; }

        /* ğŸ”¥ Ready æŒ‰éˆ• */
        .btn-ready {
            background: linear-gradient(135deg, var(--primary), var(--neon-pink));
            color: white;
            font-family: 'Bangers', cursive;
            font-size: 2rem;
            border: none;
            padding: 15px 0;
            width: 100%; max-width: 500px;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 6px 0 var(--primary-dark);
            transition: transform 0.1s;
            text-shadow: 2px 2px 0 rgba(0,0,0,0.2);
            letter-spacing: 1px;
        }
        .btn-ready:active { transform: translateY(6px); box-shadow: 0 0 0; }

        /* ğŸ“Š æ¯é€±çµ±è¨ˆå¡ç‰‡ */
        .weekly-stats {
            width: 100%; max-width: 500px;
            background: white;
            border-radius: 15px;
            padding: 15px 20px;
            margin-top: 25px;
            border: 2px solid var(--neon-blue);
            box-shadow: 4px 4px 0 rgba(139, 233, 253, 0.5);
            display: flex; justify-content: space-between; align-items: center;
        }
        .weekly-label { font-family: var(--font-bold); color: #555; font-size: 1.1rem; }
        .weekly-value { font-family: 'Bangers', cursive; font-size: 2rem; color: var(--primary); }

        /* ğŸ“… æœˆæ›†æ¨£å¼ */
        .calendar-container {
            width: 100%; max-width: 500px;
            background: white;
            border-radius: 20px;
            padding: 20px;
            margin-top: 20px;
            border: 2px solid #ddd;
        }
        .cal-header { text-align: center; font-family: var(--font-bold); font-size: 1.2rem; margin-bottom: 15px; color: var(--primary-dark); }
        .cal-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; }
        
        .cal-day {
            aspect-ratio: 1/1;
            display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            background: #f9f9f9;
            border-radius: 8px;
            font-size: 0.9rem; color: #aaa;
            position: relative;
        }
        
        /* ä¸€èˆ¬å®Œæˆ (1-19æ˜Ÿ) */
        .cal-day.done { 
            background: #e1bee7; color: var(--primary-dark); 
            border: 1px solid var(--primary); font-weight: bold; 
        }
        /* Sç´šå®Œç¾é”æˆ (20æ˜Ÿä»¥ä¸Š) */
        .cal-day.perfect { 
            background: var(--neon-pink); color: white; 
            border: 1px solid #ff4081; 
            box-shadow: 0 0 5px var(--neon-pink);
        }
        
        .cal-star-num { font-size: 0.7rem; margin-top: 2px; }
        .cal-day.today { border: 2px dashed var(--primary); }

        /* çµæœè¦–çª— (å®Œæˆå¾Œé¡¯ç¤º) */
        .result-overlay {
            display: none;
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 100;
            align-items: center; justify-content: center;
            flex-direction: column;
        }
        .result-box {
            background: white; padding: 30px; border-radius: 20px; text-align: center;
            width: 90%; max-width: 400px;
            animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .rank-badge { font-family: 'Bangers', cursive; font-size: 4rem; margin: 10px 0; }
        .rank-s { color: var(--gold); text-shadow: 2px 2px 0 #d35400; }
        .rank-a { color: var(--neon-pink); }
        .rank-b { color: var(--neon-blue); }
        
        .btn-close { 
            background: #333; color: white; border: none; padding: 10px 30px; 
            border-radius: 20px; font-size: 1.2rem; cursor: pointer; margin-top: 20px; 
        }

        .footer-tools { margin-top: 30px; text-align: center; width: 100%; }
        .reset-link { color: #ccc; text-decoration: underline; cursor: pointer; font-size: 0.9rem; }

        #confetti-canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 99; display: none; }

        @keyframes popIn { from { transform: scale(0.5); opacity: 0; } to { transform: scale(1); opacity: 1; } }
    </style>
</head>
<body>

    <header>
        <div>
            <h1>Hunter Routine</h1>
            <div class="total-stars-display">
                <span>â­</span>
                <span id="total-stars">0</span>
            </div>
        </div>
        <div class="clock-badge" id="clock">--:--</div>
    </header>

    <div class="card" id="main-card">
        <ul class="task-list" id="task-list">
            <li class="task-item" onclick="toggleCheck(this)">
                <div class="checkbox"></div>
                <span>Toilet & Brush Teeth ğŸ›</span>
            </li>
            <li class="task-item" onclick="toggleCheck(this)">
                <div class="checkbox"></div>
                <span>Change Clothes ğŸ‘—</span>
            </li>
            <li class="task-item" onclick="toggleCheck(this)">
                <div class="checkbox"></div>
                <span>Breakfast & Bag ğŸ’</span>
            </li>
            <li class="task-item" onclick="toggleCheck(this)">
                <div class="checkbox"></div>
                <span>Chinese Medicine ğŸµ</span>
            </li>
            <li class="task-item" onclick="toggleCheck(this)">
                <div class="checkbox"></div>
                <span>Everything Ready! âœ¨</span>
            </li>
        </ul>
    </div>

    <button class="btn-ready" onclick="finishRoutine()">I'm Ready!</button>

    <div class="weekly-stats">
        <span class="weekly-label">Weekly Score (æœ¬é€±æˆ°ç¸¾)</span>
        <span class="weekly-value" id="weekly-score">0 â­</span>
    </div>

    <div class="calendar-container">
        <div class="cal-header" id="cal-month-title">Calendar</div>
        <div class="cal-grid" id="cal-grid"></div>
    </div>

    <div class="footer-tools">
        <span class="reset-link" onclick="clearData()">Reset All Data</span>
    </div>

    <div class="result-overlay" id="result-overlay">
        <div class="result-box">
            <div id="result-rank" class="rank-badge">S</div>
            <h2 id="result-title">Perfect!</h2>
            <p id="result-desc" style="font-size: 1.2rem; color:#666;">+20 Stars</p>
            <p id="result-time" style="color:#aaa; margin-top:5px;">Time: 06:40</p>
            <button class="btn-close" onclick="location.reload()">See ya tomorrow!</button>
        </div>
    </div>

    <canvas id="confetti-canvas"></canvas>

    <script>
        // DOM Elements
        const clockEl = document.getElementById('clock');
        const taskList = document.getElementById('task-list');
        const totalStarsEl = document.getElementById('total-stars');
        const weeklyScoreEl = document.getElementById('weekly-score');
        const calGrid = document.getElementById('cal-grid');
        const calTitle = document.getElementById('cal-month-title');
        const resultOverlay = document.getElementById('result-overlay');
        
        // Init
        checkTuesday();
        loadData();
        
        // Clock Loop
        setInterval(() => {
            const now = new Date();
            clockEl.textContent = now.toLocaleTimeString('en-US', { hour12: false, hour: '2-digit', minute:'2-digit' });
        }, 1000);

        function toggleCheck(el) {
            el.classList.toggle('checked');
        }

        // é€±äºŒè‡ªå‹•åŠ æ³³è¡£
        function checkTuesday() {
            const now = new Date();
            if (now.getDay() === 2) { // 2 is Tuesday
                const li = document.createElement('li');
                li.className = 'task-item special';
                li.setAttribute('onclick', 'toggleCheck(this)');
                li.innerHTML = `<div class="checkbox"></div><span>Swimsuit ğŸ©± (Tue)</span>`;
                // Insert before medicine (2nd to last)
                const items = taskList.children;
                taskList.insertBefore(li, items[items.length - 2]);
            }
        }

        // å®Œæˆé‚è¼¯
        function finishRoutine() {
            const now = new Date();
            const target645 = new Date(); target645.setHours(6, 45, 0);
            const target650 = new Date(); target650.setHours(6, 50, 0);
            const target651 = new Date(); target651.setHours(6, 51, 0);
            
            let stars = 0;
            let rank = "";
            let title = "";
            let rankClass = "";

            if (now < target645) {
                stars = 20; rank = "S"; title = "GODLIKE!"; rankClass = "rank-s";
            } else if (now < target650) {
                stars = 15; rank = "A"; title = "Amazing!"; rankClass = "rank-a";
            } else if (now < target651) {
                stars = 10; rank = "B"; title = "Good Job!"; rankClass = "rank-b";
            } else {
                stars = 0; rank = "C"; title = "Try Again!"; rankClass = "rank-c";
            }

            // Show Result
            document.getElementById('result-rank').textContent = rank;
            document.getElementById('result-rank').className = "rank-badge " + rankClass;
            document.getElementById('result-title').textContent = title;
            document.getElementById('result-desc').textContent = `+${stars} Stars`;
            document.getElementById('result-time').textContent = `Finished at ${now.toLocaleTimeString('en-US', {hour12:false, hour:'2-digit', minute:'2-digit'})}`;
            
            resultOverlay.style.display = 'flex';
            if (stars > 0) startConfetti();

            saveDailyData(stars);
        }

        // è³‡æ–™å„²å­˜ (Local Storage)
        function saveDailyData(stars) {
            const today = new Date();
            const dateKey = `${today.getFullYear()}-${today.getMonth() + 1}-${today.getDate()}`;
            
            let data = JSON.parse(localStorage.getItem('hunter_data') || "{}");
            
            // è¨˜éŒ„ä»Šå¤©
            data[dateKey] = { stars: stars };
            
            localStorage.setItem('hunter_data', JSON.stringify(data));
            loadData(); // Refresh UI
        }

        function loadData() {
            const data = JSON.parse(localStorage.getItem('hunter_data') || "{}");
            const now = new Date();
            
            // 1. è¨ˆç®—ç¸½æ˜Ÿæ˜Ÿ (Total)
            let total = 0;
            Object.values(data).forEach(day => total += (day.stars || 0));
            totalStarsEl.textContent = total;

            // 2. è¨ˆç®—æœ¬é€±æ˜Ÿæ˜Ÿ (Weekly)
            let weeklyTotal = 0;
            const dayOfWeek = now.getDay(); // 0(Sun) - 6(Sat)
            const sunday = new Date(now);
            sunday.setDate(now.getDate() - dayOfWeek); // Go back to Sunday
            
            for (let i = 0; i < 7; i++) {
                let d = new Date(sunday);
                d.setDate(sunday.getDate() + i);
                const k = `${d.getFullYear()}-${d.getMonth() + 1}-${d.getDate()}`;
                if (data[k]) weeklyTotal += data[k].stars;
            }
            weeklyScoreEl.textContent = weeklyTotal + " â­";

            // 3. ç¹ªè£½æœˆæ›†
            renderCalendar(data);
        }

        function renderCalendar(data) {
            const now = new Date();
            const year = now.getFullYear();
            const month = now.getMonth();
            
            document.getElementById('cal-month-title').textContent = `${now.toLocaleString('default', { month: 'long' })} ${year}`;
            
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            const firstDayIndex = new Date(year, month, 1).getDay(); // 0 is Sunday
            
            let html = '';
            // Empty slots
            for(let i=0; i<firstDayIndex; i++) html += `<div></div>`;
            
            // Days
            for(let d=1; d<=daysInMonth; d++) {
                const k = `${year}-${month + 1}-${d}`;
                const record = data[k];
                const isToday = (d === now.getDate());
                
                let cls = 'cal-day';
                let content = d;
                
                if (isToday) cls += ' today';
                if (record) {
                    if (record.stars >= 20) {
                        cls += ' perfect'; // S Rank
                        content = `${d}<div class="cal-star-num">ğŸ‘‘${record.stars}</div>`;
                    } else {
                        cls += ' done';
                        content = `${d}<div class="cal-star-num">â­${record.stars}</div>`;
                    }
                }
                
                html += `<div class="${cls}">${content}</div>`;
            }
            calGrid.innerHTML = html;
        }

        function clearData() {
            if(confirm("Delete all history?")) {
                localStorage.removeItem('hunter_data');
                location.reload();
            }
        }

        // ç´™èŠ±ç‰¹æ•ˆ
        function startConfetti() {
            const canvas = document.getElementById('confetti-canvas');
            canvas.style.display = 'block';
            const ctx = canvas.getContext('2d');
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            const pieces = [];
            const colors = ['#9b59b6', '#ff79c6', '#f1c40f', '#8be9fd'];
            for (let i = 0; i < 150; i++) {
                pieces.push({
                    x: Math.random() * canvas.width,
                    y: Math.random() * canvas.height - canvas.height,
                    color: colors[Math.floor(Math.random() * colors.length)],
                    size: Math.random() * 8 + 4,
                    speed: Math.random() * 4 + 2,
                    rotation: Math.random() * 360
                });
            }
            function draw() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                pieces.forEach(p => {
                    ctx.save();
                    ctx.translate(p.x, p.y);
                    ctx.rotate(p.rotation * Math.PI / 180);
                    ctx.fillStyle = p.color;
                    ctx.fillRect(-p.size/2, -p.size/2, p.size, p.size);
                    ctx.restore();
                    p.y += p.speed; p.rotation += p.speed * 2;
                    if (p.y > canvas.height) p.y = -20;
                });
                requestAnimationFrame(draw);
            }
            draw();
            setTimeout(() => canvas.style.display = 'none', 5000);
        }
    </script>
</body>
</html>
